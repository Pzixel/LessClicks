namespace = build_railways_events

build_railways_events.1 = {
    type = country_event
    hidden = yes

    trigger = {
        always = yes
    }

    immediate = {
        every_scope_state = {
            set_variable = {
                name = infra_per_railroad
                value = {
                    if = {
                        limit = {
                            any_scope_building = {
                                is_building_type = building_railway
                                has_active_production_method = pm_no_passenger_trains
                            }
                        }
                        value = 20
                    }                    
                    else = {
                        value = 15
                    }
                    if = {
                        limit = {
                            any_scope_building = {
                                is_building_type = building_railway
                                has_active_production_method = pm_electric_trains
                            }        
                        }
                        add = 10
                    }    
                    if = {
                        limit = {
                            any_scope_building = {
                                is_building_type = building_railway
                                has_active_production_method = pm_diesel_trains
                            }        
                        }
                        add = 20
                    }    
                }
            }
            
            set_variable = {
                name = missing_railways
                value = {
                    add = {
                        value = state_infrastructure_balance
                        multiply = -1
                        divide = var:infra_per_railroad
                    }
                }
            }

            if = {
                limit = {
                    var:missing_railways > 0
                }
                while = {
                    count = var:missing_railways
                    start_building_construction = building_railway
                } 
            }
        }
    }
}